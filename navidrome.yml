services:
  navidrome:
    image: deluan/navidrome:0.58.5
    user: 1000:1000 # should be owner of volumes
      #ports:
      #- "4533:4533"
    restart: unless-stopped
    environment:
      - ND_REVERSEPROXYWHITELIST=0.0.0.0/0
      - ND_REVERSEPROXYUSERHEADER=X-authentik-username
      # Optional: put your config options customization here. Examples:
      # ND_LOGLEVEL: debug
    networks:
      - nas
    volumes:
      - "/data/navidrome:/data"
      - "/data/music:/music:ro"
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.navidrome.rule=Host(`music.fgdou.ovh`) && !(PathPrefix(`/share/`) || PathPrefix(`/rest/`))'
      - 'traefik.http.routers.navidrome.entryPoints=websecure'
      - 'traefik.http.services.navidrome.loadbalancer.server.port=4533'
      - 'traefik.http.routers.navidrome.middlewares=authentik@docker'
      - 'traefik.http.routers.navidrome-subsonic.rule=Host(`music.fgdou.ovh`) && (PathPrefix(`/share`) || PathPrefix(`/rest`))'
      - 'traefik.http.routers.navidrome-subsonic.entryPoints=websecure'
      - 'traefik.http.routers.navidrome-subsonic.service=navidrome'


  spotspot:
    image: ghcr.io/mattblackonly/spotspot:latest
    container_name: spotspot
      #ports:
      #- 6544:6544
    volumes:
      - /data/music:/data # If you need to change this also change it for the TRACK_OUTPUT, ALBUM_OUTPUT, PLAYLIST_OUTPUT, ARTIST_OUTPUT
      - /etc/localtime:/etc/localtime:ro # Optional. Sync time with host.
      - /etc/timezone:/etc/timezone:ro # Optional. Sync timezone with host.
    environment:
      - PUID=1000
      - PGID=1000
      - TRIGGER_JELLYFIN_SCAN=false
      - TRIGGER_PLEX_SCAN=false
      - GENERATE_M3U_PLAYLIST=false
      - TRACK_OUTPUT=/data/{artist} - {title}.{output-ext}
      - ALBUM_OUTPUT=/data/{artist} - {title}.{output-ext}
      - PLAYLIST_OUTPUT=/data/{artist} - {title}.{output-ext}
      - ARTIST_OUTPUT=/data/{artist} - {title}.{output-ext}
    restart: unless-stopped
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.spotspot.rule=Host(`spotspot.fgdou.ovh`)'
      - 'traefik.http.routers.spotspot.entryPoints=websecure'
      - 'traefik.http.services.spotspot.loadbalancer.server.port=6544'
      - 'traefik.http.routers.spotspot.middlewares=authentik@docker'
    networks:
      - nas

networks:
  nas:
    external: true
